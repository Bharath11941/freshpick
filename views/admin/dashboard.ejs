<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Fresh Pick</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/assets/imgs/theme/favicon.svg"
    />
    <!-- Template CSS -->
    <link href="/assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <div class="screen-overlay"></div>
    <%- include("../layouts/adminSidebar.ejs") %>
    <main class="main-wrap">
      <%- include("../layouts/adminNavbar.ejs") %>
      <section class="content-main">
        <div class="content-header">
          <div>
            <h2 class="content-title card-title">Dashboard</h2>
            <p>Whole data about your business here</p>
          </div>
          <div>
            <a href="/admin/salesReport" class="btn btn-primary"
              ><i class="text-muted material-icons md-post_add"></i>Create
              report</a
            >
          </div>
        </div>
        <div class="row">
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-primary-light"
                  ><i class="text-primary material-icons md-monetization_on"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Total Revenue</h6>
                  <span>₹ <%=totalRevenue[0].total %></span>
                  <span class="text-sm"> Shipping fees are not included </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-success-light"
                  ><i class="text-success material-icons md-local_shipping"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Orders</h6>
                  <span><%=ordersCount %></span>
                  <span class="text-sm"> Excluding orders in transit </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-warning-light"
                  ><i class="text-warning material-icons md-qr_code"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Products</h6>
                  <span><%=productsCount %></span>
                  <span class="text-sm">
                    In <%=categoryCount %> Categories
                  </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-info-light"
                  ><i class="text-info material-icons md-shopping_basket"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Current Month Earning</h6>
                  <span>₹ <%=earnings[0].monthlyEarnings %></span>
                  <span class="text-sm"> Based in your local time. </span>
                </div>
              </article>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-info-light"
                  ><i class="text-info material-icons md-shopping_basket"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Today</h6>
                  <span>₹ <%=todayRevenue[0].total %></span>
                  <span class="text-sm"
                    >from <%=todayRevenue[0].count %> Orders
                  </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-info-light"
                  ><i class="text-info material-icons md-shopping_basket"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Current Week</h6>
                  <span>₹ <%=currentWeekRevenue[0].total %></span>
                  <span class="text-sm"
                    >from <%=currentWeekRevenue[0].count %> Orders
                  </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-xl-8 col-lg-12">
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Sale statistics</h5>
                <canvas id="myChart" height="120px"></canvas>
              </article>
            </div>
            <br />
            <br /><br />
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Users statistics</h5>
                <!-- Correct the ID to match the chart ID in JavaScript -->
                <div id="chart4"></div>
              </article>
            </div>
          </div>
          <div class="col-xl-4 col-lg-12">
            <div class="card mb-4">
              <article class="card-body">
                <h3 class="card-title">Trending Products</h3>
                <% trending.forEach(product=>{%>
                <div class="new-member-list">
                  <div
                    class="d-flex align-items-center justify-content-between mb-4"
                    style="margin-left: 20px"
                  >
                    <div class="d-flex align-items-center">
                      <img
                        src="/productImages/resized/<%=product.productImage[0]%>"
                        alt=""
                        class="avatar"
                      />
                      <div style="margin-left: 10px">
                        <h4><%=product.productName%></h4>
                        <p class="text-muted font-xs">
                          <span>Sold: </span><%=product.total%>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <% }) %>
              </article>
            </div>
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Order Details</h5>
                <div id="chart"></div>
              </article>
            </div>
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Category Sold</h5>
                <div id="chart3"></div>
              </article>
            </div>
          </div>
        </div>
        <div class="card mb-4">
          <header class="card-header">
            <h4 class="card-title">Latest orders</h4>
          </header>
          <div class="card-body">
            <div class="table-responsive">
              <div class="table-responsive">
                <table class="table align-middle table-nowrap mb-0">
                  <thead class="table-light">
                    <tr>
                      <th class="align-middle" scope="col">Order ID</th>
                      <th class="align-middle" scope="col">Billing Name</th>
                      <th class="align-middle" scope="col">Date</th>
                      <th class="align-middle" scope="col">Total</th>
                      <th class="align-middle" scope="col">Payment Status</th>
                      <th class="align-middle" scope="col">Payment Method</th>
                      <th class="align-middle" scope="col">View Details</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if(orderData.length>0) { orderData.forEach(order => { %>
                    <tr>
                      <td><a href="#" class="fw-bold"><%= order._id %></a></td>
                      <td><b><%= order.user.fname %></b></td>
                      <td><%= order.date %></td>
                      <td>₹ <%= order.total %></td>
                      <td>
                        <% if (order.status !== "Cancelled") { %>
                        <span class="badge badge-pill badge-soft-success"
                          ><%= order.status %></span
                        >
                        <% }else{%>
                        <span class="badge badge-pill badge-soft-danger"
                          ><%= order.status %></span
                        >
                        <% } %>
                      </td>
                      <td><%= order.method %></td>
                      <td>
                        <a
                          href="/admin/orderDetails?id=<%= order._id %>"
                          class="btn btn-xs"
                        >
                          View details</a
                        >
                      </td>
                    </tr>
                    <% }) } else { %>
                    <tr>
                      <td colspan="8">
                        <p class="text-center">No Orders</p>
                      </td>
                    </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- table-responsive end// -->
          </div>
        </div>
      </section>
      <!-- content-main end// -->
      <footer class="main-footer font-xs">
        <div class="row pb-30 pt-15">
          <div class="col-sm-6">
            <script>
              document.write(new Date().getFullYear());
            </script>
            &copy; Nest - HTML Ecommerce Template .
          </div>
          <div class="col-sm-6">
            <div class="text-sm-end">All rights reserved</div>
          </div>
        </div>
      </footer>
      <!-- sales by year -->
      <input type="hidden" id="jan" value="<%=salesData[0]%>" />
      <input type="hidden" id="feb" value="<%=salesData[1]%>" />
      <input type="hidden" id="mar" value="<%=salesData[2]%>" />
      <input type="hidden" id="apr" value="<%=salesData[3]%>" />
      <input type="hidden" id="may" value="<%=salesData[4]%>" />
      <input type="hidden" id="jun" value="<%=salesData[5]%>" />
      <input type="hidden" id="jul" value="<%=salesData[6]%>" />
      <input type="hidden" id="aug" value="<%=salesData[7]%>" />
      <input type="hidden" id="sep" value="<%=salesData[8]%>" />
      <input type="hidden" id="oct" value="<%=salesData[9]%>" />
      <input type="hidden" id="nov" value="<%=salesData[10]%>" />
      <input type="hidden" id="dec" value="<%=salesData[11]%>" />

      <!-- users by year -->
      <input type="hidden" id="jans" value="<%=usersData[0]%>" />
      <input type="hidden" id="febs" value="<%=usersData[1]%>" />
      <input type="hidden" id="mars" value="<%=usersData[2]%>" />
      <input type="hidden" id="aprs" value="<%=usersData[3]%>" />
      <input type="hidden" id="mays" value="<%=usersData[4]%>" />
      <input type="hidden" id="juns" value="<%=usersData[5]%>" />
      <input type="hidden" id="juls" value="<%=usersData[6]%>" />
      <input type="hidden" id="augs" value="<%=usersData[7]%>" />
      <input type="hidden" id="seps" value="<%=usersData[8]%>" />
      <input type="hidden" id="octs" value="<%=usersData[9]%>" />
      <input type="hidden" id="novs" value="<%=usersData[10]%>" />
      <input type="hidden" id="decs" value="<%=usersData[11]%>" />
    </main>
    <script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/vendors/select2.min.js"></script>
    <script src="/assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/assets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/assets/js/vendors/chart.js"></script>
    <!-- Main Script -->
    <script src="/assets/js/main.js?v=1.1" type="text/javascript"></script>
    <script src="/assets/js/custom-chart.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>
    <script>
      var placedCount = parseInt("<%= placedCount %>");
      var deliveredCount = parseInt("<%= deliveredCount %>");
      var cancelledCount = parseInt("<%= cancelledCount %>");
      let jans = Number(document.getElementById("jans").value);
      let febs = Number(document.getElementById("febs").value);
      let mars = Number(document.getElementById("mars").value);
      let aprs = Number(document.getElementById("aprs").value);
      let mays = Number(document.getElementById("mays").value);
      let juns = Number(document.getElementById("juns").value);
      let juls = Number(document.getElementById("juls").value);
      let augs = Number(document.getElementById("augs").value);
      let seps = Number(document.getElementById("seps").value);
      let octs = Number(document.getElementById("octs").value);
      let novs = Number(document.getElementById("novs").value);
      let decs = Number(document.getElementById("decs").value);

      var options = {
        series: [placedCount, deliveredCount, cancelledCount],
        chart: {
          width: 350,
          type: "pie",
        },
        labels: ["Placed", "Delivered", "Cancelled"],
        responsive: [
          {
            breakpoint: 480,
            options: {
              chart: {
                width: 200,
              },
              legend: {
                position: "bottom",
              },
            },
          },
        ],
      };

      var chart1 = new ApexCharts(document.querySelector("#chart"), options);
      chart1.render();

      let veg = parseInt("<%=ordersCategory.Vegetables%>");
      let fru = parseInt("<%=ordersCategory.Fruits%>");
      let dry = parseInt("<%=ordersCategory.Dried%>");
      // Check for NaN and set the value to 0 if it's NaN
      veg = isNaN(veg) ? 0 : veg;
      fru = isNaN(fru) ? 0 : fru;
      dry = isNaN(dry) ? 0 : dry;
      console.log(veg, fru, dry);
      var options = {
        series: [veg, fru, dry, 0],
        chart: {
          type: "donut",
        },
        labels: ["Vegetables", "Fruits", "Dry Fruits", "Juices"], // Add the names of the series here
        responsive: [
          {
            breakpoint: 480,
            options: {
              chart: {
                width: 200,
              },
              legend: {
                position: "bottom",
              },
            },
          },
        ],
      };

      var chart2 = new ApexCharts(document.querySelector("#chart3"), options);
      chart2.render();

      var barOptions = {
        series: [
          {
            name: "Servings",
            data: [
              jans,
              febs,
              mars,
              aprs,
              mays,
              juns,
              juls,
              augs,
              seps,
              octs,
              novs,
              decs,
            ],
          },
        ],
        annotations: {
          points: [
            {
              x: "Bananas",
              seriesIndex: 0,
              label: {
                borderColor: "#775DD0",
                offsetY: 0,
                style: {
                  color: "#fff",
                  background: "#775DD0",
                },
                text: "Bananas are good",
              },
            },
          ],
        },
        chart: {
          height: 350,
          type: "bar",
        },
        plotOptions: {
          bar: {
            borderRadius: 10,
            columnWidth: "50%",
          },
        },
        dataLabels: {
          enabled: false,
        },
        stroke: {
          width: 2,
        },
        grid: {
          row: {
            colors: ["#fff", "#f2f2f2"],
          },
        },
        xaxis: {
          labels: {
            rotate: -45,
          },
          categories: [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ],
          tickPlacement: "on",
        },
        fill: {
          type: "gradient",
          gradient: {
            shade: "light",
            type: "horizontal",
            shadeIntensity: 0.25,
            gradientToColors: undefined,
            inverseColors: true,
            opacityFrom: 0.85,
            opacityTo: 0.85,
            stops: [50, 0, 100],
          },
        },
      };

      var barChart = new ApexCharts(
        document.querySelector("#chart4"),
        barOptions
      );
      barChart.render();
    </script>
  </body>
</html>
